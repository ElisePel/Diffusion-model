# Image generation with diffusion models
A Tensorflow implementation of Diffusion model using horseshoe dataset. The purpose of this project is to generate new horseshoe. 
- Please refer to [Forward-noising.py](Forward-noising.py) for more information in the forward noising processus.
- Please refer to [Backward-denoising.py](Diffusion-model/Backward-denoising.py) for more information in the backward noising processus.
- Please refer to [U-Net.py](Diffusion-model/U-Net.py) for more information in the U-Net model.
- Please refer to [DDPM-inference-algorithm.py](Diffusion-model/DDPM-inference-algorithm.py) for more information in the U-Net model.

# Tables
- [Visualization](#visualization)
- [Denoising Diffusion Probabilistic Models inference algorithm](#denoising-diffusion-probabilistic-models-inference-algorithm)
- [How to load the weights](#how-to-load-the-weights) 
- [References](#references)


# Visualization

## Noise visualization
Adding noise to an image : Forward noising

![image](https://user-images.githubusercontent.com/98736513/229776242-b4aeb7c0-72be-4d5d-9204-738e6ce94a5e.png)

## Denosing visualization
Backward denoising
![image](https://user-images.githubusercontent.com/98736513/229785108-c5148a6f-d9f3-495c-ab84-63f023eb6a4a.png)


## Horseshoe Generation 
Random image creation and denoising steps
<p align="center">
<img width="250" alt="2022-04-09_122409" src="https://user-images.githubusercontent.com/98736513/229776537-0a3b8490-34f5-47d3-982d-cff0acd7c738.gif">
<img width="250" alt="2022-04-09_122409" src="https://user-images.githubusercontent.com/98736513/229782535-b1cde1a3-e5a1-400b-be73-0e0d574add04.gif">
<img width="250" alt="2022-04-09_122409" src="https://user-images.githubusercontent.com/98736513/229782868-a7cb0d79-d4b4-4313-a889-853649b1a411.gif">
</p>


# Denoising Diffusion Probabilistic Models inference algorithm

<p align="center">
<img width="400" alt="2022-04-09_122409" src="https://user-images.githubusercontent.com/98736513/232741869-d908aa01-a860-44b4-9891-d794a59e473c.png">
</p>

Here xt is a random sample, which we pass through our U-Net model and obtain Є_θ, then we calculate xt-1according to the formula:

<p align="center">
<img width="250" alt="2022-04-09_122409" src="https://user-images.githubusercontent.com/98736513/232742651-db5b755b-6aa0-4e71-aa23-9472c7a81f56.png">
</p>

Example of GIF generated by using the DDPM inference algorithm :

<p align="center">
<img width="300" alt="2022-04-09_122409" src="https://user-images.githubusercontent.com/98736513/229776537-0a3b8490-34f5-47d3-982d-cff0acd7c738.gif">
</p>

# How to load the weights
```
# create our unet model
unet = Unet(channels=1)

# initialize the model in the memory of our GPU
test_images = X_train[0].reshape(1, 32, 32, 1)
test_timestamps = generate_timestamp(0, 1)
k = unet(test_images, test_timestamps)

# create our optimizer, we will use adam with a Learning rate of 1e-4
opt = keras.optimizers.Adam(learning_rate=learning_rate)

unet.load_weights('weights')
```

# References
I work with :
- Medium article : https://medium.com/@vedantjumle/image-generation-with-diffusion-models-using-keras-and-tensorflow-9f60aae72ac
- Denoising Diffusion Probabilistic Models : https://arxiv.org/abs/2006.11239
- Denoising Diffusion Implicit Models : https://arxiv.org/abs/2010.02502
